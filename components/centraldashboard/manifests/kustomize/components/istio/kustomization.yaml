apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
resources:
  - virtual-service.yaml
  - authorizationpolicy.yaml
configurations:
  - params.yaml
replacements:
  - source:
      fieldPath: metadata.namespace
      kind: Service
      name: dashboard
      version: v1
    targets:
      - fieldPaths:
          - spec.http.0.route.0.destination.host
        options:
          delimiter: .
          index: 1
        select:
          group: networking.istio.io
          kind: VirtualService
          name: dashboard
          version: v1alpha3
  - source:
      fieldPath: data.CD_CLUSTER_DOMAIN
      kind: ConfigMap
      name: dashboard-parameters
      version: v1
    targets:
      - fieldPaths:
          - spec.http.0.route.0.destination.host
        options:
          delimiter: .
          index: 3
        select:
          group: networking.istio.io
          kind: VirtualService
          name: dashboard
          version: v1alpha3
